<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Shigaro</title>
  <meta name="author" content="minyez">
  
  <meta name="description" content="minyez&#39;s blog on life, science and programming">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Shigaro"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/assets/images/favicon/icon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111612868-1', 'auto');
  ga('send', 'pageview');
</script>





<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>



</head>

 <body 
>
  <nav id="main-nav" class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/"></a>
    <div class="collapse navbar-collapse nav-menu">
      <ul class="nav navbar-nav">
        

        <!-- Categories -->
        
        <li>
          <a href="/" title="Shigaro's Home"
            style="font-weight: normal; font-family: Calibri,Arial; font-size: 18px">
            <i class="fa fa-bank"></i>Home
          </a>
        </li>
        
        

        <!-- Categories -->
        
        <!-- Archives -->
        <li>
          <a href="/archives" title="All the articles."
            style="font-weight: normal; font-family: Calibri,Arial; font-size:     18px">
            <i class="fa fa-archive"></i>Archives
          </a>
        </li>
        
        

        <!-- Categories -->
        
        <!-- Tags -->
        <li>
          <a href="/tags" title="All the tags."
            style="font-weight: normal; font-family: Calibri,Arial; font-size:     18px">
            <i class="fa fa-tags"></i>Tags
          </a>
        </li>
        
        

        <!-- Categories -->
        
        <li class="dropdown">
          <a href="/categories" class="dropdown-toggle" data-toggle="dropdown" title="All the categories."
            style="font-weight: normal; font-family: Calibri,Arial; font-size:     18px">
            <i class="fa fa-folder"></i>Categories
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li class="divider"></li>
            <li><a href="/categories" style="font-size: 20px; font-family: 'Calibri Light',Arial">All
                Categories</a><span></span></li>
            <li class="divider"></li>
            
            <li><a href="/categories/Software/"
                style="font-size: 15px; font-family: 微软雅黑">Software<span></span></a></li>
            
            <li><a href="/categories/Programming/"
                style="font-size: 15px; font-family: 微软雅黑">Programming<span></span></a></li>
            
            <li><a href="/categories/Comment/"
                style="font-size: 15px; font-family: 微软雅黑">Comment<span></span></a></li>
            
            <li><a href="/categories/Algorithm/"
                style="font-size: 15px; font-family: 微软雅黑">Algorithm<span></span></a></li>
            
            <li class="divider"></li>
          </ul>
        </li>
        
        

        <!-- Categories -->
        
        <li>
          <a href="/about" title="About me."
            style="font-weight: normal; font-family: Calibri,Arial; font-size: 18px">
            <i class="fa fa-user"></i>About
          </a>
        </li>
        
        
      </ul>
    </div>
  </div> <!-- container -->
</nav>
<div class="clearfix"></div>
  <div class="container">
  	<div class="content">
    	 <div class="page-header">
  <h1 class="home-title">Shigaro</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-code"></i>
      朝日が昇る　私は旅する
</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-10-01 </div>
			<div class="article-title"><a href="/2020/10/01/emacs-3-org-latex-export/" >Emacs 笔记 (三) —— Org-mode 导出到 LaTeX 与 Beamer</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<link rel="stylesheet" type="text/css" href="/css/hint.min.css"><p><div class="alert alert-success"><i class="fa fa-lightbulb-o  float-left"></i>  <p>简单介绍了将 org 文件导出为 LaTeX 普通文档或 Beamer 演示所需要的基本准备, 包括 org 文档格式和相关 Lisp 变量的自定义.</p>
</div>
&lt;!-- more --&gt;</p>
<h2>前言</h2>
<p>前面两篇博文谈及 Emacs 和 Org-mode 的基本操作。经过了快三个月的练习，现在对两者也算是熟悉了一些. 目前 Emacs+Org 已经成为我整理文献，分析数据和撰写研究报告的主力工具. 其中对我最重要的一个功能就是 org 文本向 LaTeX 和 Beamer 的导出. 通过编写导出模板，可以使用同一个 org 文件，不改动正文就可以同时导出 LaTeX 和 Beamer 格式的 tex 文档，再进行编译.</p>
<p>本文是对我自己的 LaTeX 导出配置的一个整理和回顾。对 <code>config</code> 文件全文感兴趣的朋友可以移步我的 <a href="https://github.com/minyez/dotfiles/blob/master/doom.d/config.el" target="_blank" rel="noopener">dotfiles 项目</a>. 欢迎提出改进意见.</p>
<h2>LaTeX 导出的最小工作实例</h2>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+TITLE: MWE of LaTeX export</span><br><span class="line">#+LATEX_CLASS: article</span><br><span class="line">#+LATEX_COMPILER: xelatex</span><br><span class="line">#+LATEX_HEADER: \usepackage[dvipsnames]&#123;xcolor&#125;</span><br><span class="line"></span><br><span class="line">This is a \colortext&#123;Blue&#125;&#123;minimal&#125; working example for \LaTeX export of org file</span><br><span class="line"></span><br><span class="line">这是 org 文件导出为 \LaTeX 文档的最小工作实例.</span><br></pre></td></tr></table></figure></p>
<p>快捷键 <code>C-c C-e l l</code> 即可导出 <code>.tex</code> 后缀的同名文件, 其中就是转换好的 LaTeX 代码. <code>C-c C-e l o</code> 可以在导出后立刻编译, 清理临时文件, 随后打开编译好的 pdf. 这里有四点需要说明:</p>
<p>第一, 导出的核心是头部参数 <code>LATEX_CLASS</code>。前者需要在变量 <code>org-latex-classes</code> (一个 list) 中预先定义. 它的默认值是</p>
<p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">(</span><br><span class="line">  (<span class="string">"article"</span></span><br><span class="line">   <span class="string">"\\documentclass[11pt]&#123;article&#125;"</span></span><br><span class="line">   (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\paragraph&#123;%s&#125;"</span> . <span class="string">"\\paragraph*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subparagraph&#123;%s&#125;"</span> . <span class="string">"\\subparagraph*&#123;%s&#125;"</span>))</span><br><span class="line">  (<span class="string">"report"</span></span><br><span class="line">   <span class="string">"\\documentclass[11pt]&#123;report&#125;"</span></span><br><span class="line">   (<span class="string">"\\part&#123;%s&#125;"</span> . <span class="string">"\\part*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\chapter&#123;%s&#125;"</span> . <span class="string">"\\chapter*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>))</span><br><span class="line">  (<span class="string">"book"</span> <span class="string">"\\documentclass[11pt]&#123;book&#125;"</span></span><br><span class="line">   (<span class="string">"\\part &#123;%s&#125;"</span> . <span class="string">"\\part*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\chapter &#123;%s&#125;"</span> . <span class="string">"\\chapter*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\section &#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>)))</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>列表中每个元素也是一个列表, 各自对应一个预定义的 LaTeX 类. 每个类需要这样几个要素</p>
<ul>
<li>类名称 (字符串)</li>
<li>对应的 LaTeX 文档类 (字符串)</li>
<li>各标题层级的转换规则 (不定数量的 cons cell)</li>
</ul>
<p>类名称是 <code>LATEX_CLASS</code> 可以取的值. 可以看到默认值里定义了三个 LaTeX 类, 分别对应于 article, report, book 三个实际的 LaTeX 文档类. 定义文档类的 <code>documentclass</code> 语句, 再转换时会被添加到 tex 文件的最开头. 原则上写在这一行的所有内容都会被添加到 tex 的开头, 即序言部分. 因此我们可以对这一字符串做更复杂的自定义来满足自己的需求. 这一点后面会再提到. 后面的每个 cons cell 是 Org 各层级有序号和无序号标题转换的规则. 第一个对应一级标题, 第二个对应二级标题, 以此类推. 比如在 book 类中, 一级标题会被转换为 <code>part</code>, 三级无序标题会被转换为 <code>section*</code>. 可以在 <code>config.el</code> 自定义 LaTeX类. 例如添加如下代码即可增加一个 <code>beamer</code> 类</p>
<p><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">(<span class="name">add-to-list</span> 'org-latex-classes</span><br><span class="line">  '(<span class="string">"beamer"</span></span><br><span class="line">    <span class="string">"\\documentclass[ignorenonframetext,presentation]&#123;beamer&#125;"</span></span><br><span class="line">    (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">    (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>它对应于 LaTeX 中的 <code>beamer</code> 文档类.</p>
<p>第二, <code>LATEX_COMPILER</code> 指明使用何种编译器来编译转换的 tex 文件. Org 提供了一条默认的编译 tex 文件的命令, 写在变量 <code>org-latex-pdf-process</code> 中. 默认是一个包含按次序执行的 latex 指令的列表, 因为在编译 tex 时由于交叉引用等原因, 编译器通常需要与 biber 等附加程序一起对源文档多次编译. 我们可以将其修改为使用 <code>latexmk</code> 等比较智能的编译器, 比如</p>
<p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">latexmk -latexoption="-interaction=nonstopmode -shell-escape" -pdf -pdflatex=%latex -bibtex -f %f</span><br></pre></td></tr></table></figure></p>
<p>这里的 <code>%latex</code> 对应于 <code>LATEX_COMPILER</code> 的值, <code>%f</code> 对应于所产生的 tex 文档的相对路径.</p>
<p>第三, 在转换为 tex 时, Org 原文中的 <code>\LaTeX</code>, <code>\colortext</code> 命令将不作任何转换, 原样导出. Org 会自动识别 <code>\</code>, <code>\begin{}..\end{}</code> 这样具有 LaTeX 特征的语句, 并在导出为 LaTeX 时保留它. 如果想编写专属 LaTeX 导出的内容, 可以使用 <code>@@latex: xxx@@</code> 的形式, 此时 <code>xxx</code> 只会在 tex 中出现, 而不会出现在 Markdown, HTML 等其他格式的导出中.</p>
<p>第四, <code>LATEX_HEADER</code> 允许包含任何序言区命令, 在默认情况下会添加到序言区末尾. 可添加任意行 <code>LATEX_HEADER</code>, 以便对特定文档进行序言区的定制. 如果一些序言是所有 LaTeX 导出公用的, 可以考虑添加到类声明当中. 如果是一个 package, 则可以加入到 <code>org-latex-packages-alist</code> 或 <code>org-latex-default-packages-alist</code>.</p>
<h2>Beamer 导出的最小工作实例</h2>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+TITLE: MWE of Beamer Export</span><br><span class="line">#+AUTHOR: minyez</span><br><span class="line">#+OPTIONS: H:3</span><br><span class="line">#+BEAMER_THEME: CambridgeUS</span><br><span class="line">#+LATEX_CLASS_OPTION: [presentation]</span><br><span class="line">#+LATEX_COMPILER: pdflatex</span><br><span class="line">#+LATEX_HEADER: \usepackage&#123;physics&#125;</span><br><span class="line">#+BEAMER_HEADER: \institute[Bed, Home]&#123;Bedroom \\ My House&#125;</span><br><span class="line"></span><br><span class="line">* This is a section</span><br><span class="line">** Subsection A</span><br><span class="line">*** Frame one</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\braket&#123;\phi_i&#125;&#123;\phi_j&#125; = \delta_&#123;ij&#125;</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">*** Frame two</span><br><span class="line">Not an empty frame</span><br><span class="line">* This is another section</span><br><span class="line">** Subsection B</span><br><span class="line">non-frame text here</span><br></pre></td></tr></table></figure></p>
<p>这里, <code>LATEX_COMPILER</code> 和前面 LaTeX 导出中的作用相同. OPTIONS 中用 <code>H:3</code> 指定三级标题转化为 Beamer 帧. 比如这里的 &quot;Frame one&quot; 和 &quot;Frame two&quot; 都会被转化为帧. slides 主题用 <code>BEAMER_THEME</code> 指定. 其他自定义命令用 <code>BEAMER_HEADER</code> 指定, 它们将被添加到 <code>LATEX_HEADER</code> 之后. 与 LaTeX 导出不同, <code>LATEX_CLASS</code> 不是必须的, 导出时默认使用 <code>beamer</code> 类, 但可用 <code>LATEX_CLASS_OPTION</code> 为 Beamer 文档类的 <code>\documentclass</code> 添加选项.</p>
<h2>自定义 LaTeX 导出类</h2>
<p>我们可以在 <code>org-latex-classes</code> 中定义比单独 <code>\documentclass</code> 更为复杂的序言. 事实上, Org 在导出时会检查 header 中的 <code>[DEFAULT-PACKAGES]</code>, <code>[PACKAGES]</code>, <code>[EXTRA]</code> 占位符. 如果没有这些占位符, 也未找到对应的 <code>[NO-*]</code>, 那么导出时会用 <code>org-latex-default-packages-alist</code>, <code>org-latex-packages-alist</code> 列表和文档的 <code>LATEX_HEADER</code> 语句展开对应的占位符. 如果找到了任意一个, 则会在该位置展开. 例如, 定义一个新的 <code>colorarticle</code> 类</p>
<p><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">(<span class="name">add-to-list</span> 'org-latex-classes</span><br><span class="line">  '(<span class="string">"colorarticle"</span></span><br><span class="line">   <span class="string">"\\documentclass[11pt,4paper]&#123;article&#125;</span></span><br><span class="line"><span class="string">[PACKAGES]</span></span><br><span class="line"><span class="string">\\usepackage[dvipsnames,svgnames*]&#123;xcolors&#125;</span></span><br><span class="line"><span class="string">[EXTRA]</span></span><br><span class="line"><span class="string">\\definecolor&#123;bg&#125;&#123;rgb&#125;&#123;0.95,0.95,0.95&#125;</span></span><br><span class="line"><span class="string">\\definecolors&#123;AliceBlue&#125;</span></span><br><span class="line"><span class="string">[NO-DEFAULT-PACKAGES]"</span></span><br><span class="line">   (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\paragraph&#123;%s&#125;"</span> . <span class="string">"\\paragraph*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subparagraph&#123;%s&#125;"</span> . <span class="string">"\\subparagraph*&#123;%s&#125;"</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>这里会在 xcolors 前导入 <code>org-latex-packages-alist</code> 中定义的包, 在之后导入文档中 <code>LATEX_HEADER</code>, 但不会导入 <code>org-latex-default-packages-alist</code>. 以这种方式引入宏包的目的是方便在不同类中引入一些常用的宏包, 简化自定义类的编写.</p>
<p>之所以提供 <code>org-latex-packages-alist</code> 和 <code>org-latex-default-packages-alist</code> 两个参数, 可能是考虑到有的包适合在序言最开始包括 (如 <code>amsmath</code>, <code>xcolor</code> 等). 而有的包必须放在最后以避免可能的包冲突. (如 <code>hyperref</code>, <code>cleveref</code>). 笔者一般是把前者放在序言头部, 后者放在结尾.</p>
<h3>宏包列表</h3>
<p>默认宏包列表 <code>org-latex-default-packages-alist</code> 和宏包列表 <code>org-latex-packages-alist</code> 具有类似的结构. 先看默认宏包 (为简洁起见, 这里只包含一部分)</p>
<p><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-default-packages-alist</span><br><span class="line">  '(</span><br><span class="line">    (<span class="string">""</span> <span class="string">"amsmath"</span> <span class="literal">t</span>) ; include first to avoid iint and iiint error</span><br><span class="line">    (<span class="string">""</span> <span class="string">"amssymb"</span> <span class="literal">t</span>)</span><br><span class="line">    (<span class="string">""</span> <span class="string">"wasysym"</span> <span class="literal">t</span>) ; include last to avoid iint and iint error</span><br><span class="line">    (<span class="string">"AUTO"</span> <span class="string">"inputenc"</span>  <span class="literal">t</span> (<span class="string">"pdflatex"</span>))</span><br><span class="line">    (<span class="string">"T1"</span>   <span class="string">"fontenc"</span>   <span class="literal">t</span> (<span class="string">"pdflatex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"CJKutf8"</span>   <span class="literal">t</span> (<span class="string">"pdflatex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"xeCJK"</span>     <span class="literal">nil</span> (<span class="string">"xelatex"</span>, <span class="string">"xetex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"fontspec"</span>  <span class="literal">nil</span> (<span class="string">"xelatex"</span>, <span class="string">"xetex"</span>, <span class="string">"lualatex"</span>, <span class="string">"luatex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"graphicx"</span>  <span class="literal">t</span>)</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"xcolor"</span>  <span class="literal">t</span>)</span><br><span class="line">    (<span class="string">"newfloat,cache=true"</span>   <span class="string">"minted"</span>   <span class="literal">nil</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>列表中每一个元素是一个列表, 最多包含四个参数</p>
<ol>
<li>宏包的选项 (字符串)</li>
<li>宏包名称 (字符串)</li>
<li>编译 tex 片断预览时是否导入 (布尔值)</li>
<li>编译器 (即 <code>LATEX_COMPILER</code>) 依赖 (列表), 只在用该编译器时导出. 留空则表示无论何编译器均导出.</li>
</ol>
<p><code>org-latex-packages-alist</code> 是类似的</p>
<p><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-packages-alist</span><br><span class="line">  '(; hyperref and cleverf should be the last packages to load</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"hyperref"</span>  <span class="literal">nil</span>)</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"cleveref"</span>   <span class="literal">nil</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>考虑到不同文档中需要 hyperref 包的选项 (链接颜色, 边框等) 不同, 因此比较灵活的办法是留空 alist 变量中 hyperref 的选项, 通过在 LaTeX 类定义的头部中指定 <code>PassOptionsToPackages</code> 来传递选项.</p>
<h3>代码块风格控制</h3>
<p>通常有两种方式来控制 LaTeX 文档中代码块的表现, listings 或 minted. 由于 minted 适用的语言更多, 风格也更为灵活, 笔者选择其作为代码块渲染</p>
<p><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-listings 'minted)</span><br></pre></td></tr></table></figure></p>
<p>并使用 <code>org-latex-minted-options</code> 控制 minted 环境的选项</p>
<p><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-minted-options</span><br><span class="line">      '(</span><br><span class="line">        (<span class="string">"bgcolor"</span> <span class="string">"bg"</span>)</span><br><span class="line">        (<span class="string">"breaklines"</span> <span class="string">"true"</span>)</span><br><span class="line">        (<span class="string">"autogobble"</span> <span class="string">"true"</span>)</span><br><span class="line">        (<span class="string">"fontsize"</span> <span class="string">"\\small"</span>)</span><br><span class="line">       )</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h2>结合 watchman 模拟异步编译</h2>
<p>在 Emacs 内编译 tex 虽然方便, 但是对于编译较大的文档, 或者交叉引用需要多次编译时, 编译动作需要较长的时间. 默认情况下, 编译是在 Emacs 进程内执行的, 这会导致我们在编译时无法进行其他操作, 造成时间的浪费. 在 Linux 下, 可以用 <code>watchman-make</code> 监控 <code>org-directory</code> 下 tex 文件的情况, 一旦有变化就执行 <code>make</code>. <a href="https://facebook.github.io/watchman/docs/watchman-make.html" target="_blank" rel="noopener">watchman-make</a> 是 Facebook 开源项目 <a href="https://facebook.github.io/watchman/" target="_blank" rel="noopener">watchman</a> 的一个组件, 用 Python 编写. 一件需要注意的事情是, 用 Homebrew 安装的 <code>watchman</code>, 在使用时会遇到 <a href="https://github.com/facebook/watchman/issues/631" target="_blank" rel="noopener">name 'basestring' is not defined</a> 错误. 简单的修复办法是, 找到它报错的一行把 <code>basestring</code> 改成 <code>str</code>, 然后就能正常使用了.</p>
<p>Org-mode 在内部支持异步导出和编译, 但是需要额外编辑异步导出的模板 <code>async-init.el</code>. 笔者稍微调试了一下这个文件, 但并未成功. 在导出元素比较丰富的 org 文档时, 转换本身可能就比较慢, 需要用异步的方式来提高效率. 目前需要还不是很明显, 等以后有机会研究, 届时再作更新.</p>
<h2>总结</h2>
<p>本文给出了笔者对 org 文档 LaTeX 导出的基本功能的探索, 对于普通文档的导出应当是够用了. 然而值得推敲和探索的还有很多, 比如异步导出模板, 利用 <code>LATEX_CLASS</code> 实现普通文档和 Beamer 演示导出之间的敏捷切换, 多行多列表格, 以及利用表格和 gnuplot 源代码在 org 文档内直接作图, 等等. 希望之后还有时间精力能把这些分享出来.</p>
<p>&lt;!-- 在 <code>org-latex-classes</code> 里准备好 <code>beamer</code> 类. 同时, 定义另外一个普通的文档类, 例如名为 <code>beamerarticle</code> 的 article 文档类,
并将 <code>beamerarticle</code> 包添加到 class 的序言区 (或 <code>LATEX_HEADER</code>) 内.--&gt;</p>

	
	</div>
  <!-- categories -->
  <span style="font-size:90%">
  
  <i style="color:#bbb" class="fa fa-folder"></i> <a style="color:#bbb" href="/categories/Software/">Software</a>
  </span>
  &nbsp
  <!-- tags -->
  <span style="font-size:90%" >
  
  <a style="color:#bbb" href="/tags/LaTeX/">#LaTeX</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/Emacs/">#Emacs</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/Org-mode/">#Org-mode</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/Beamer/">#Beamer</a>
  </span>
  <!-- read more button -->
  <a type="button" href="/2020/10/01/emacs-3-org-latex-export/#more" class="pull-right btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-07-19 </div>
			<div class="article-title"><a href="/2020/07/19/fiddle-proof/" >fiddle-proof 与拖延症</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<link rel="stylesheet" type="text/css" href="/css/hint.min.css"><p><div class="alert alert-success"><i class="fa fa-lightbulb-o  float-left"></i>  <p>捣鼓工具有感.</p>
</div>
&lt;!-- more --&gt;</p>
<p>在捣鼓 Org-mode 的 $\rm\LaTeX$ 导出时偶然间被 refer 到一封 Org-mode 作者 Carsten Dominik 写的 <a href="https://orgmode.org/list/0277B507-1486-4172-B1C6-1B73B84148DD@science.uva.nl/" target="_blank" rel="noopener">mail-list</a> 下。原文主题是比较 Org 和另一个 GTD 软件 <a href="https://www.taskpaper.com/" target="_blank" rel="noopener">TaskPaper</a> (上一篇《<a href="/2020/07/01/macos-float-window/" title="在 macOS 中置顶窗口">在 macOS 中置顶窗口</a>》就是为了这个软件). 大意是作为纯文本 GTD, Org-mode 就是 TaskPaper. Org-mode 诚然提供了大量功能，但这并非强迫用户去使用。用户更不需要从一开始就去 (学其他人) 构建一个繁杂的 GTD 系统。更好的办法是从最基本的 TODO 和 DONE 开始，根据自己需求慢慢扩展.</p>
<p>笔者是赞同这个观点的。复杂的待办系统要对待办分类，加优先级，加标签，周期重复等等。这么做的终极目的是把事务做清晰的划分，方便筛选以避开来自冗余信息的影响。然而这个复杂的系统本身就可能成为 &quot;冗余信息&quot;. 别人的 GTD 系统，在自己身上可能完全是 nonsense. 与其从头理解然后套用，不如构建一个适合自己的系统。亲切和趁手比什么都重要.</p>
<p>让我感触最深的并不是这个观点，而是 Carsten 引出 Org-mode 高度可定制的优势时说的一句</p>
<blockquote>
<p>What is so great about taskpaper that it is (so far?) almost fiddle-proof. It is a list, and there is no way to fiddle with it. People who use fiddling with the TODO system as a way to procrastinate can clearly benefit from such a system.</p>
</blockquote>
<p>&quot;fiddle&quot; 有摆弄、把玩 (瞎搞) 的意思，而 proof 后缀表示 &quot;protecting against&quot;, 合起来就是 &quot;不给瞎搞&quot;. 跟 org-mode 相比，TaskPaper 能鼓捣的内容确实少：它支持标签 (<code>@</code>), 但不支持多种 TODO 标记，也不支持事项的作业计时 (org-mode 下有 <code>org-clock-in/out</code>), 更不用提各种代码块、导出功能。第二句 &quot;借鼓捣 GTD 系统来拖延的人显然可因此获益.&quot; 想起在 DDL 面前依然去折腾各种新旧工具和软件的自己，这一句十分扎心。特别当这些工具中的很多现在其实已经不怎么用的时候，当初 fiddling 只为拖延似乎就千真万确、难以辩驳了.</p>
<p>然而 TaskPaper 真的能帮助人不去 procrastinate 吗？即便是 Carsten 认为 &quot;fiddle-proof&quot; 的 TaskPaper, 我也折腾了 macOS 窗口置顶，花了不少时间做 CSS 定制，而不是去做那些 TODO 们。在看到 Org-mode 后转去鼓捣 Emacs 这一深坑，TaskPaper 自然而然被忘在了角落。</p>
<p>一个人如果想 procrastinate, 他总可以找到无数的办法。即使是 fiddle-proof 的东西他也能找到把玩的角度。要是手头上的东西不足以让他继续 procrastinate，他就会去找新的。今天云《对马岛之魂》时还听到这样一句话: &quot;成事在人，而非刀剑.&quot; 可能不是非常恰当，但对于任何现代工具也是一样：工具始终只是工具，解决问题的只能是人。而 Procrastinator 不是不想解决问题。他们是对真正重要的问题选择了视而不见。</p>

	
	</div>
  <!-- categories -->
  <span style="font-size:90%">
  
  <i style="color:#bbb" class="fa fa-folder"></i> <a style="color:#bbb" href="/categories/Comment/">Comment</a>
  </span>
  &nbsp
  <!-- tags -->
  <span style="font-size:90%" >
  
  <a style="color:#bbb" href="/tags/GTD/">#GTD</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/note-taking/">#note-taking</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/TaskPaper/">#TaskPaper</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/Org-mode/">#Org-mode</a>
  </span>
  <!-- read more button -->
  <a type="button" href="/2020/07/19/fiddle-proof/#more" class="pull-right btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-07-18 </div>
			<div class="article-title"><a href="/2020/07/18/remap-macos-keys/" >修改 macOS 上外设键盘的键位映射</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<link rel="stylesheet" type="text/css" href="/css/hint.min.css"><p><div class="alert alert-success"><i class="fa fa-lightbulb-o  float-left"></i>  <p>用 <code>hidutil</code> 对 macOS 外设键盘改键，并设置开机自启.</p>
</div>
&lt;!-- more --&gt;</p>
<h2>前言</h2>
<p>最近在用 Emacs 编写文本时遇到的一个问题就是频繁地缩回小拇指去按左 ctrl 很不方便。因此想着把大小写锁定键改成 ctrl. 在 macOS 上，修改内置键盘键位是比较容易的，<code>系统偏好</code> =&gt; <code>键盘</code> =&gt; <code>修饰键</code>, 就可以随便改。但这一修改不会应用到外接键盘上 (笔者用的是 Logi MX Keys). <a href="https://mic-kul.com/2020/01/25/mx-keys-remap-right-alt/" target="_blank" rel="noopener">搜索</a> 后发现可以用 <code>hidutil</code> 解决这个问题.</p>
<h2>修改外设键盘映射</h2>
<p>手册上，<code>hidutil</code> 被解释为用于管理人机接口设备 (Human Interface Device, HID) 事件系统的实用程序。我理解的 HID 就是键鼠，手柄，方向盘之类。修改键位需要用到它的 <code>property</code> 命令，通过脚本来说明可能更加直接。编写 <code>remap_keyboard.sh</code> 脚本</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line">hidutil property --matching <span class="string">'&#123;"Product": "MX Keys"&#125;'</span> \</span><br><span class="line">    --<span class="built_in">set</span> <span class="string">'&#123;"UserKeyMapping": [&#123;"HIDKeyboardModifierMappingSrc":0x700000039,</span></span><br><span class="line"><span class="string">                                "HIDKeyboardModifierMappingDst":0x7000000e0&#125;]&#125;'</span></span><br></pre></td></tr></table></figure></p>
<p>选项的具体含义可通过 <code>hidutil property --help</code> 了解。这里做一些简单说明</p>
<ul>
<li><code>--matching</code> 选项用来匹配需要修改的外设，值是一个字典。这里用的 Key 是产品名 <code>Product</code>. 如果不知道产品名，可以用 <code>hidutil list</code> 了解设备情况. RegistryID 等信息也能从这里看到.</li>
<li><code>--set</code> 用来设置属性值。相应的，提取属性是 <code>--get</code>.</li>
<li>改键对应的 Key 是 <code>UserKeyMapping</code>, 值是一个列表。列表中每一个元素是一个字典。这里用于映射修饰键的 Key 是 <code>HIDKeyboardModifierMappingSrc</code> 和 <code>HIDKeyboardModifierMappingDst</code>. 通俗的说，<code>Src</code> 是键盘上的键，<code>Dst</code> 是机器实际接收的按键，用 16 进制数表示。键位值是 <code>0x700000000</code> 加上对应的 Usage ID, 可以在 <a href="https://developer.apple.com/library/archive/technotes/tn2450/_index.html" target="_blank" rel="noopener">Apple 文档</a> 上查到. CapsLock 是 <code>39</code>, 左 Ctrl 是 <code>e0</code>.</li>
</ul>
<p>写完后，加上权限运行即可</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chmod +x remap_keyboard.sh</span><br><span class="line">./remap_keyboard.sh</span><br></pre></td></tr></table></figure></p>
<h2>开机自启</h2>
<p>系统重启后，映射会失效。所以需要把它写进开机自启动项里。可以用 Automator 的 App, 也可以用 <code>launchctl</code>. 参考 <a href="https://stackoverflow.com/questions/6442364/running-script-upon-login-mac" target="_blank" rel="noopener">SO 回答</a>, 编写 plist</p>
<p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">plist</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//Apple Computer//DTD PLIST 1.0//EN"</span> <span class="meta-string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">string</span>&gt;</span>com.user.loginscript<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">array</span>&gt;</span><span class="tag">&lt;<span class="name">string</span>&gt;</span>/path/to/remap_keyboard.sh<span class="tag">&lt;/<span class="name">string</span>&gt;</span><span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>命名为 <code>com.user.loginscript.plist</code>, 保存到 <code>~/Library/LaunchAgents</code> 下。然后用 <code>launchctl</code> 修改启动项</p>
<p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">launchctl load ~/Library/LaunchAgents/com.user.loginscript.plist</span><br></pre></td></tr></table></figure></p>
<p>重启测试似乎并没有成功 (*/ω＼*) 索性放到 bin 下，发现 capslock 恢复后就手动运行，倒也算是解决了吧.</p>

	
	</div>
  <!-- categories -->
  <span style="font-size:90%">
  
  <i style="color:#bbb" class="fa fa-folder"></i> <a style="color:#bbb" href="/categories/Software/">Software</a>
  </span>
  &nbsp
  <!-- tags -->
  <span style="font-size:90%" >
  
  <a style="color:#bbb" href="/tags/macOS/">#macOS</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/keyboard/">#keyboard</a>
  </span>
  <!-- read more button -->
  <a type="button" href="/2020/07/18/remap-macos-keys/#more" class="pull-right btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-07-02 </div>
			<div class="article-title"><a href="/2020/07/02/emacs-2/" >Emacs 笔记 (二) —— 初识 Org-mode</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<link rel="stylesheet" type="text/css" href="/css/hint.min.css"><p><div class="alert alert-warning"><i class="fa fa-bell  float-left"></i>  <p>有关 Org-mode 基本使用的学习笔记.</p>
</div>
&lt;!--more--&gt;</p>
<p>在使用 Org-roam 前首先是学习 Org-mode 的使用。这里大量参考了 Zaiste 的 <a href="https://www.youtube.com/watch?v=rCMh7srOqvw&amp;list=PLhXZp00uXBk4np17N39WvB80zgxlZfVwj" target="_blank" rel="noopener">Doom Emacs 系列视频</a>, 特别是 E09-E13.</p>
<h2>Org 文件</h2>
<p>任何格式的纯文本都可以用 Org-mode 打开。在打开 <code>.org</code> 后缀文件时，Emacs 会自动启用 Org-mode. 与 Markdown 和 rST 等轻量标记语言类似，org 文件也需要一些标记符号来激活它的功能.</p>
<table>
<thead>
<tr>
<th>标记符号</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>层级标题</td>
</tr>
<tr>
<td><code>+</code></td>
<td>无序列表</td>
</tr>
<tr>
<td><code>&lt;&lt;nanme&gt;&gt;</code></td>
<td>id 为 <code>name</code> 的锚</td>
</tr>
<tr>
<td><code>[[name]]</code></td>
<td>指向 <code>name</code> 的内链接</td>
</tr>
<tr>
<td><code>[[target][desp]]</code></td>
<td>文本 <code>desp</code> 具有指向 <code>target</code> 的链接。可以是外链</td>
</tr>
<tr>
<td><code>*text*</code></td>
<td>加粗</td>
</tr>
<tr>
<td><code>_text_</code></td>
<td>下划线</td>
</tr>
<tr>
<td><code>*text*</code></td>
<td>高亮</td>
</tr>
<tr>
<td><code>+text+</code></td>
<td>删除</td>
</tr>
<tr>
<td><code>/text/</code></td>
<td>斜体</td>
</tr>
<tr>
<td><code>=text=</code></td>
<td>打字机 (verbatim) 模式</td>
</tr>
<tr>
<td><code>~text~</code></td>
<td>代码模式</td>
</tr>
</tbody>
</table>
<p>在导出时，打字机和代码模式都统一导出为打字机模式各种强调记号可以通过 <code>org-emphasis-alist</code> 变量进行自定义.</p>
<h2>按键操作</h2>
<p>一些会经常用到的捆绑键位，作为简单的 cheatsheet</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>M-↑/↓</code></td>
<td>上下移动整个层级</td>
</tr>
<tr>
<td><code>M-h</code></td>
<td>上升一个层级</td>
</tr>
<tr>
<td><code>M-l</code></td>
<td>下降一个层级</td>
</tr>
<tr>
<td><code>C-RET</code></td>
<td>在下方插入新条目 (表格，清单)</td>
</tr>
<tr>
<td><code>C-s-RET</code></td>
<td>在上方插入新条目 (表格，清单)</td>
</tr>
<tr>
<td><code>SPC m l l</code></td>
<td>创建 / 编辑链接</td>
</tr>
<tr>
<td><code>SPC m l d</code></td>
<td>移除链接</td>
</tr>
<tr>
<td><code>SPC n l</code></td>
<td>为选定文本制作书签，存入链接库备选</td>
</tr>
<tr>
<td><code>SPC m '</code></td>
<td>为选中元素调用特殊编辑器</td>
</tr>
<tr>
<td><code>RET</code></td>
<td>转到链接目标</td>
</tr>
<tr>
<td><code>D</code> (大写 D)</td>
<td>返回链接位置</td>
</tr>
<tr>
<td><code>C-C C-x C-n/p</code></td>
<td>下 / 上一个链接位置</td>
</tr>
</tbody>
</table>
<p>一个小贴士是，可以用 <code>M-x general-describe-keybindings</code> 确认一个捆绑键对应的函数.</p>
<h2>org 文件编辑</h2>
<h3>创建链接</h3>
<p>Org-mode 尤其有用的功能是其方便的内链创建.</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">* Heading 1</span><br><span class="line">  ** Subheading 1</span><br><span class="line">    This is link to [[Heading 2]]</span><br><span class="line">    这是一个锚 &lt;&lt;anchor&gt;&gt;</span><br><span class="line"></span><br><span class="line">  ** Subheading 2</span><br><span class="line">    跳转到锚 [[anchor]]</span><br><span class="line"></span><br><span class="line">* Heading 2</span><br><span class="line">  Go to [[https://www.google.com][Google.com]]</span><br></pre></td></tr></table></figure></p>
<p>此外，Org-mode 支持多种 <a href="https://orgmode.org/manual/External-Links.html#External-Links" target="_blank" rel="noopener">外部链接</a>. 除内链和网页外还支持本地文件 <code>file:</code>, <code>doi:</code>, Emacs Lisp 脚本 <code>elisp:</code> 以及 Shell 脚本 <code>shell:</code> 等。它允许自定义链接，例如在 <code>config.el</code> 中加入下列代码可以创建由 AV 或 BV 号到 b 站视频的链接 <code>blbl:</code></p>
<p><figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line"><span class="comment">; 创建连接 bilibili 视频的链接</span></span><br><span class="line">(<span class="name">defun</span> make-bilibili-link (<span class="name">vid</span>)</span><br><span class="line">  (<span class="name">browse-url</span> (<span class="name">concat</span> <span class="string">"https://www.bilibili.com/video/"</span> vid))  </span><br><span class="line">)</span><br><span class="line">(<span class="name">after!</span> org</span><br><span class="line">  (<span class="name">org-add-link-type</span> <span class="string">"blbl"</span> #'make-bilibili-link)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h3>可执行代码块</h3>
<p>输入 <code>&lt;s</code> 后 <code>TAB</code>, 创建一个如下环境，可在其中编写代码.</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+BEGIN_SRC LANG</span><br><span class="line">//code here</span><br><span class="line">#+END_SRC</span><br></pre></td></tr></table></figure></p>
<p>比如我们在其中用 C 编写 Hello World:</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+BEGIN_SRC c</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int main () &#123;</span><br><span class="line">  printf (&quot;Hello World!&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">#+END_SRC</span><br></pre></td></tr></table></figure></p>
<p>编写完成后，退出编辑模式。在 <code>END_SRC</code> 下回车，就会自动将输出结果添加到源代码块下方.</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+RESULTS:</span><br><span class="line">: Hello World!</span><br></pre></td></tr></table></figure></p>
<p>如果改变了代码的内容，只要选中代码块任意位置重新回车，即可更新输出结果. <span class="label label-info">Q</span> <code>#+RESULTS</code> 部分似乎不会被导出，有待确认)</p>
<h3>LaTeX 导出初探</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>C-c C-e l l</code></td>
<td>导出.org 文件到.tex 文件</td>
</tr>
<tr>
<td><code>C-c C-e l L</code></td>
<td>将.org 文件导出为 tex, 加载到新缓冲区</td>
</tr>
<tr>
<td><code>C-c C-e l p</code></td>
<td>导出.org 文件到.tex 文件，并转换为 pdf</td>
</tr>
<tr>
<td><code>C-c C-e l o</code></td>
<td>导出.org 文件到.tex 文件，转换为 pdf 同时用默认浏览器打开</td>
</tr>
</tbody>
</table>
<p>在用 LaTeX 导出时，用如下代码块包围的内容会被直接导出</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#+BEGIN_LATEX</span><br><span class="line">\LaTeX</span><br><span class="line">#+END_LATEX</span><br></pre></td></tr></table></figure></p>
<p>导出结果为</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\LaTeX</span><br></pre></td></tr></table></figure></p>
<h2>相关文章</h2>
<p><a href="/2020/07/01/emacs-1/" title="Emacs 笔记 (一) —— 安装与配置 Doom Emacs">Emacs 笔记 (一) —— 安装与配置 Doom Emacs</a></p>
<h2>参考资料</h2>
<p>Org-mode 官方手册: <a href="https://orgmode.org/manual/" target="_blank" rel="noopener">https://orgmode.org/manual/</a></p>

	
	</div>
  <!-- categories -->
  <span style="font-size:90%">
  
  <i style="color:#bbb" class="fa fa-folder"></i> <a style="color:#bbb" href="/categories/Software/">Software</a>
  </span>
  &nbsp
  <!-- tags -->
  <span style="font-size:90%" >
  
  <a style="color:#bbb" href="/tags/Emacs/">#Emacs</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/note-taking/">#note-taking</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/Org-mode/">#Org-mode</a>
  </span>
  <!-- read more button -->
  <a type="button" href="/2020/07/02/emacs-2/#more" class="pull-right btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-07-01 </div>
			<div class="article-title"><a href="/2020/07/01/macos-float-window/" >在 macOS 中置顶窗口</a></div>						
		</h3>
	


			<div class="entry">
  <div class="row">
	
	
		<link rel="stylesheet" type="text/css" href="/css/hint.min.css"><p><div class="alert alert-success"><i class="fa fa-lightbulb-o  float-left"></i>  <p>使用 MacForge 和 AfloatX 插件, 在 Mojave 系统下允许窗口置顶.</p>
</div>
&lt;!--more--&gt;</p>
<h2>前言</h2>
<p>macOS 上一直困扰我的问题是没有简单的窗口置顶工具. 在 PC 下, 播放器之类的很多软件在任务栏上都有一个小图钉图标, 点一下就可以置顶. 但是 macOS 上竟然找不到自带这样功能的软件. 这归因于自 Mac OS El Capitan 以后苹果引入的系统完整性保护 (System Integrity Protection, SIP). 根据<a href="https://en.wikipedia.org/wiki/System_Integrity_Protection#Functions" target="_blank" rel="noopener">维基百科</a>, SIP 禁止用户对根目录下 <code>/System</code> 和 <code>/usr</code> 等特定文件夹的修改, 关闭代码注入和运行时进程附着, 禁止未签名的内核扩展. 由此看来, 将窗口置顶可能涉及向Finder运行时进行代码注入从而被 SIP 禁止, 因此按正常流程发布的 app 就不可能实现这个功能了. 但另一方面, 窗口置顶是否有可能通过由 app 发送置顶请求到 Finder, Finder 向用户一次性请求权限的方式来实现呢? 这就要看今后 Apple 的 macOS 更新了.</p>
<p>可是对于 Mojave 来说恐怕等不到那个时候, 所以还是得自己想办法. <a href="https://www.maketecheasier.com/mac-keeping-your-application-window-always-on-top/" target="_blank" rel="noopener">这篇文章</a>提供了比较完整的思路, 主要是利用 mySIMBL 进行代码注入, 置顶功能由 <a href="https://github.com/rwu823/afloat" target="_blank" rel="noopener">Afloat</a> 提供. 有点遗憾的是, 这篇文章时间比较久远了, mySIMBL 已经升级成了 <a href="https://github.com/MacEnhance/MacForge" target="_blank" rel="noopener">MacForge</a>, Afloat 数年没有更新, 几乎被 <a href="https://github.com/jslegendre/AfloatX" target="_blank" rel="noopener">AfloatX</a> 取代. 不过基本思路没有变化, 就在这里简单记录一下流程.</p>
<h2>流程记录</h2>
<h3>Step 1 部分关闭SIP</h3>
<p>这一部分在 <a href="https://github.com/MacEnhance/MacForge/wiki/Installation" target="_blank" rel="noopener">MacForge Wiki 页</a>上有充分的描述. 重启, 按住 <code>CMD+R</code> 进入 recovery mode. 从左上角菜单栏打开终端, 输入以下部分关闭 SIP 的命令</p>
<p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">csrutil enable --without fs --without nvram --without debug</span><br></pre></td></tr></table></figure></p>
<p><code>without</code> 选项指定禁止的 SIP 功能. 对应内容可由直接输入 <code>csrutil</code> 来理解</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ csrutil</span><br><span class="line">System Integrity Protection status: enabled (Custom Configuration).</span><br><span class="line">Configuration:</span><br><span class="line">    Apple Internal: disabled</span><br><span class="line">    Kext Signing: enabled</span><br><span class="line">    Filesystem Protections: disabled</span><br><span class="line">    Debugging Restrictions: disabled</span><br><span class="line">    DTrace Restrictions: enabled</span><br><span class="line">    NVRAM Protections: disabled</span><br><span class="line">    BaseSystem Verification: enabled</span><br><span class="line"></span><br><span class="line">This is an unsupported configuration, likely to break in the future and leave your machine in an unknown state.</span><br></pre></td></tr></table></figure></p>
<p><code>fs</code> 指文件系统保护, <code>debug</code> 指调试限制, <code>nvram</code> 指非易失性存储器 (<a href="https://en.wikipedia.org/wiki/Non-volatile_random-access_memory" target="_blank" rel="noopener">Non-volatile random-access memory</a>, NVRAM) 保护. NVRAM 是内存的一部分, 用于存储快速访问的设置, 包括<a href="https://support.apple.com/zh-cn/HT204063" target="_blank" rel="noopener">内核崩溃信息</a>.</p>
<h3>Step 2 安装MacForge</h3>
<p>解压 GitHub 中<a href="https://github.com/w0lfschild/app_updates/raw/master/MacForge/MacForge.zip" target="_blank" rel="noopener">最新发布的压缩包</a>, 然后将 <code>.app</code> 移到应用程序中.</p>
<h3>Step 3 安装AfloatX</h3>
<p>打开 MacForge, 从 Featured 页面找到 AfloatX, GET 即可.</p>
<p><figure class="null"><img src="plugin.png" alt=" "><figcaption> </figcaption></figure></p>
<h3>Step 4 置顶窗口</h3>
<p>打开想要置顶的窗口, 右击对应 app 的 Dock 图标, 在 AfloatX 里选择 <code>Float Window</code>, 窗口置顶就完成了. 关闭一次窗口重新打开, 就可以取消置顶.</p>
<p><figure class="null"><img src="float-taskpaper.png" alt=" "><figcaption> </figcaption></figure></p>
<p>完工 (ง •̀_•́)ง 置顶 GTD app 窗口对于健忘+拖延的我来说就是救命恩人 (bushi).</p>

	
	</div>
  <!-- categories -->
  <span style="font-size:90%">
  
  <i style="color:#bbb" class="fa fa-folder"></i> <a style="color:#bbb" href="/categories/Software/">Software</a>
  </span>
  &nbsp
  <!-- tags -->
  <span style="font-size:90%" >
  
  <a style="color:#bbb" href="/tags/macOS/">#macOS</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/MacForge/">#MacForge</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/Afloatx/">#Afloatx</a>&nbsp&nbsp<a style="color:#bbb" href="/tags/GTD/">#GTD</a>
  </span>
  <!-- read more button -->
  <a type="button" href="/2020/07/01/macos-float-window/#more" class="pull-right btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
        

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/2/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/Algorithm/">Algorithm<span class="badge">2</span></a></li>
		
			<li><a href="/categories/Comment/">Comment<span class="badge">2</span></a></li>
		
			<li><a href="/categories/Programming/">Programming<span class="badge">7</span></a></li>
		
			<li><a href="/categories/Software/">Software<span class="badge">26</span></a></li>
		
		</ul>
	</div>


		
			




	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/Band-structure/">Band structure<span class="badge">2</span></a></li>
		
			<li><a href="/tags/Jupyter/">Jupyter<span class="badge">1</span></a></li>
		
			<li><a href="/tags/GW/">GW<span class="badge">2</span></a></li>
		
			<li><a href="/tags/MKL/">MKL<span class="badge">1</span></a></li>
		
			<li><a href="/tags/Fortran/">Fortran<span class="badge">3</span></a></li>
		
			<li><a href="/tags/LIBXC/">LIBXC<span class="badge">1</span></a></li>
		
			<li><a href="/tags/F2PY/">F2PY<span class="badge">1</span></a></li>
		
			<li><a href="/tags/Tutorial/">Tutorial<span class="badge">1</span></a></li>
		
			<li><a href="/tags/AST/">AST<span class="badge">1</span></a></li>
		
			<li><a href="/tags/map/">map<span class="badge">1</span></a></li>
		
			<li><a href="/tags/Python/">Python<span class="badge">3</span></a></li>
		
			<li><a href="/tags/Org-roam/">Org-roam<span class="badge">1</span></a></li>
		
			<li><a href="/tags/Hexo/">Hexo<span class="badge">4</span></a></li>
		
			<li><a href="/tags/Make/">Make<span class="badge">1</span></a></li>
		
			<li><a href="/tags/LaTeX/">LaTeX<span class="badge">3</span></a></li>
		
			<li><a href="/tags/Emacs/">Emacs<span class="badge">3</span></a></li>
		
		
		   <li><a href="/tags">...<span class="badge">55</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github-square"></i><a href="https://github.com/minyez" title="My Github account." target="_blank"]);">Github-minyez</a></li>
	
		<li><i class="fa fa-book"></i><a href="https://www.douban.com/people/shigaro" title="My DouBan account" target="_blank"]);">DouBan - Shigaro</a></li>
	
		<li><i class="fa fa-book"></i><a href="https://bookmeter.com/users/1169010" title="My Bookmeter account" target="_blank"]);">読書メーター - minyez</a></li>
	
		<li><i class="fa fa-mail-forward"></i><a href="mailto:zmysmile0929@163.com" title="Send Email to me" target="_blank"]);">Email</a></li>
	
		<li><i class="fa fa-code"></i><a href="https://github.com/minyez/minyez.github.io/tree/hexo" title="Source codes of this site" target="_blank"]);">Site source</a></li>
	
		<li><i class="fa fa-rss"></i><a href="atom.xml" title="atom rss" target="_blank"]);"> RSS</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2020 by <a href="http://shigaro.org"> minyez </a>
  
    | <a href="http://github.com/minyez/hexo-theme-freemind/">Theme</a> based on two Freemind themes by <a href="https://github.com/wzpan/hexo-theme-freemind/">wzpan</a> and <a href="https://github.com/PytLab/hexo-theme-freemind/">PytLab</a> 
    | Powered by <a href="https://github.com/hexojs/hexo">Hexo</a>
  
    <span id="busuanzi_container_site_uv">| <span id="busuanzi_value_site_uv"></span> visitors</span>
  
  
	| <span class="post-count">54.3k</span> words
  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<!--    added 2018-07-12 -->
<!-- modified 2019-05-10 -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111612868-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111612868-1');
</script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        },
        TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
   </html>
