<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Emacs 笔记 (三) —— Org-mode 导出到 LaTeX 与 Beamer | Shigaro</title>
  <meta name="author" content="minyez">
  
  <meta name="description" content="minyez&#39;s blog on life, science and programming">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Emacs 笔记 (三) —— Org-mode 导出到 LaTeX 与 Beamer"/>
  <meta property="og:site_name" content="Shigaro"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/assets/images/favicon/icon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111612868-1', 'auto');
  ga('send', 'pageview');
</script>





<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>



</head>

 <body 
>
  <nav id="main-nav" class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="/"></a>
    <div class="collapse navbar-collapse nav-menu">
      <ul class="nav navbar-nav">
        

        <!-- Categories -->
        
        <li>
          <a href="/" title="Shigaro's Home"
            style="font-weight: normal; font-family: Calibri,Arial; font-size: 18px">
            <i class="fa fa-bank"></i>Home
          </a>
        </li>
        
        

        <!-- Categories -->
        
        <!-- Archives -->
        <li>
          <a href="/archives" title="All the articles."
            style="font-weight: normal; font-family: Calibri,Arial; font-size:     18px">
            <i class="fa fa-archive"></i>Archives
          </a>
        </li>
        
        

        <!-- Categories -->
        
        <!-- Tags -->
        <li>
          <a href="/tags" title="All the tags."
            style="font-weight: normal; font-family: Calibri,Arial; font-size:     18px">
            <i class="fa fa-tags"></i>Tags
          </a>
        </li>
        
        

        <!-- Categories -->
        
        <li class="dropdown">
          <a href="/categories" class="dropdown-toggle" data-toggle="dropdown" title="All the categories."
            style="font-weight: normal; font-family: Calibri,Arial; font-size:     18px">
            <i class="fa fa-folder"></i>Categories
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li class="divider"></li>
            <li><a href="/categories" style="font-size: 20px; font-family: 'Calibri Light',Arial">All
                Categories</a><span></span></li>
            <li class="divider"></li>
            
            <li><a href="/categories/Software/"
                style="font-size: 15px; font-family: 微软雅黑">Software<span></span></a></li>
            
            <li><a href="/categories/Programming/"
                style="font-size: 15px; font-family: 微软雅黑">Programming<span></span></a></li>
            
            <li><a href="/categories/Comment/"
                style="font-size: 15px; font-family: 微软雅黑">Comment<span></span></a></li>
            
            <li><a href="/categories/Algorithm/"
                style="font-size: 15px; font-family: 微软雅黑">Algorithm<span></span></a></li>
            
            <li class="divider"></li>
          </ul>
        </li>
        
        

        <!-- Categories -->
        
        <li>
          <a href="/about" title="About me."
            style="font-weight: normal; font-family: Calibri,Arial; font-size: 18px">
            <i class="fa fa-user"></i>About
          </a>
        </li>
        
        
      </ul>
    </div>
  </div> <!-- container -->
</nav>
<div class="clearfix"></div>
  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">		
			<h1> Emacs 笔记 (三) —— Org-mode 导出到 LaTeX 与 Beamer</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <link rel="stylesheet" type="text/css" href="/css/hint.min.css"><div class="alert alert-success"><i class="fa fa-lightbulb-o  float-left"></i>  <p>简单介绍了将 org 文件导出为 LaTeX 普通文档或 Beamer 演示所需要的基本准备, 包括 org 文档格式和相关 Lisp 变量的自定义.</p>
</div>
<a id="more"></a>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前面两篇博文谈及 Emacs 和 Org-mode 的基本操作。经过了快三个月的练习，现在对两者也算是熟悉了一些. 目前 Emacs+Org 已经成为我整理文献，分析数据和撰写研究报告的主力工具. 其中对我最重要的一个功能就是 org 文本向 LaTeX 和 Beamer 的导出. 通过编写导出模板，可以使用同一个 org 文件，不改动正文就可以同时导出 LaTeX 和 Beamer 格式的 tex 文档，再进行编译.</p>
<p>本文是对我自己的 LaTeX 导出配置的一个整理和回顾。对 <code>config</code> 文件全文感兴趣的朋友可以移步我的 <a href="https://github.com/minyez/dotfiles/blob/master/doom.d/config.el" target="_blank" rel="noopener">dotfiles 项目</a>. 欢迎提出改进意见.</p>
<h2 id="LaTeX-导出的最小工作实例"><a href="#LaTeX-导出的最小工作实例" class="headerlink" title="LaTeX 导出的最小工作实例"></a>LaTeX 导出的最小工作实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#+TITLE: MWE of LaTeX export</span><br><span class="line">#+LATEX_CLASS: article</span><br><span class="line">#+LATEX_COMPILER: xelatex</span><br><span class="line">#+LATEX_HEADER: \usepackage[dvipsnames]&#123;xcolor&#125;</span><br><span class="line"></span><br><span class="line">This is a \colortext&#123;Blue&#125;&#123;minimal&#125; working example for \LaTeX export of org file</span><br><span class="line"></span><br><span class="line">这是 org 文件导出为 \LaTeX 文档的最小工作实例.</span><br></pre></td></tr></table></figure>
<p>快捷键 <code>C-c C-e l l</code> 即可导出 <code>.tex</code> 后缀的同名文件, 其中就是转换好的 LaTeX 代码. <code>C-c C-e l o</code> 可以在导出后立刻编译, 清理临时文件, 随后打开编译好的 pdf. 这里有四点需要说明:</p>
<p>第一, 导出的核心是头部参数 <code>LATEX_CLASS</code>。前者需要在变量 <code>org-latex-classes</code> (一个 list) 中预先定义. 它的默认值是</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">  (<span class="string">"article"</span></span><br><span class="line">   <span class="string">"\\documentclass[11pt]&#123;article&#125;"</span></span><br><span class="line">   (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\paragraph&#123;%s&#125;"</span> . <span class="string">"\\paragraph*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subparagraph&#123;%s&#125;"</span> . <span class="string">"\\subparagraph*&#123;%s&#125;"</span>))</span><br><span class="line">  (<span class="string">"report"</span></span><br><span class="line">   <span class="string">"\\documentclass[11pt]&#123;report&#125;"</span></span><br><span class="line">   (<span class="string">"\\part&#123;%s&#125;"</span> . <span class="string">"\\part*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\chapter&#123;%s&#125;"</span> . <span class="string">"\\chapter*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>))</span><br><span class="line">  (<span class="string">"book"</span> <span class="string">"\\documentclass[11pt]&#123;book&#125;"</span></span><br><span class="line">   (<span class="string">"\\part &#123;%s&#125;"</span> . <span class="string">"\\part*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\chapter &#123;%s&#125;"</span> . <span class="string">"\\chapter*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\section &#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>)))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>列表中每个元素也是一个列表, 各自对应一个预定义的 LaTeX 类. 每个类需要这样几个要素</p>
<ul>
<li>类名称 (字符串)</li>
<li>对应的 LaTeX 文档类 (字符串)</li>
<li>各标题层级的转换规则 (不定数量的 cons cell)</li>
</ul>
<p>类名称是 <code>LATEX_CLASS</code> 可以取的值. 可以看到默认值里定义了三个 LaTeX 类, 分别对应于 article, report, book 三个实际的 LaTeX 文档类. 定义文档类的 <code>documentclass</code> 语句, 再转换时会被添加到 tex 文件的最开头. 原则上写在这一行的所有内容都会被添加到 tex 的开头, 即序言部分. 因此我们可以对这一字符串做更复杂的自定义来满足自己的需求. 这一点后面会再提到. 后面的每个 cons cell 是 Org 各层级有序号和无序号标题转换的规则. 第一个对应一级标题, 第二个对应二级标题, 以此类推. 比如在 book 类中, 一级标题会被转换为 <code>part</code>, 三级无序标题会被转换为 <code>section*</code>. 可以在 <code>config.el</code> 自定义 LaTeX类. 例如添加如下代码即可增加一个 <code>beamer</code> 类</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">add-to-list</span> 'org-latex-classes</span><br><span class="line">  '(<span class="string">"beamer"</span></span><br><span class="line">    <span class="string">"\\documentclass[ignorenonframetext,presentation]&#123;beamer&#125;"</span></span><br><span class="line">    (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">    (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>它对应于 LaTeX 中的 <code>beamer</code> 文档类.</p>
<p>第二, <code>LATEX_COMPILER</code> 指明使用何种编译器来编译转换的 tex 文件. Org 提供了一条默认的编译 tex 文件的命令, 写在变量 <code>org-latex-pdf-process</code> 中. 默认是一个包含按次序执行的 latex 指令的列表, 因为在编译 tex 时由于交叉引用等原因, 编译器通常需要与 biber 等附加程序一起对源文档多次编译. 我们可以将其修改为使用 <code>latexmk</code> 等比较智能的编译器, 比如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">latexmk -latexoption="-interaction=nonstopmode -shell-escape" -pdf -pdflatex=%latex -bibtex -f %f</span><br></pre></td></tr></table></figure>
<p>这里的 <code>%latex</code> 对应于 <code>LATEX_COMPILER</code> 的值, <code>%f</code> 对应于所产生的 tex 文档的相对路径.</p>
<p>第三, 在转换为 tex 时, Org 原文中的 <code>\LaTeX</code>, <code>\colortext</code> 命令将不作任何转换, 原样导出. Org 会自动识别 <code>\</code>, <code>\begin{}..\end{}</code> 这样具有 LaTeX 特征的语句, 并在导出为 LaTeX 时保留它. 如果想编写专属 LaTeX 导出的内容, 可以使用 <code>@@latex: xxx@@</code> 的形式, 此时 <code>xxx</code> 只会在 tex 中出现, 而不会出现在 Markdown, HTML 等其他格式的导出中.</p>
<p>第四, <code>LATEX_HEADER</code> 允许包含任何序言区命令, 在默认情况下会添加到序言区末尾. 可添加任意行 <code>LATEX_HEADER</code>, 以便对特定文档进行序言区的定制. 如果一些序言是所有 LaTeX 导出公用的, 可以考虑添加到类声明当中. 如果是一个 package, 则可以加入到 <code>org-latex-packages-alist</code> 或 <code>org-latex-default-packages-alist</code>.</p>
<h2 id="Beamer-导出的最小工作实例"><a href="#Beamer-导出的最小工作实例" class="headerlink" title="Beamer 导出的最小工作实例"></a>Beamer 导出的最小工作实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#+TITLE: MWE of Beamer Export</span><br><span class="line">#+AUTHOR: minyez</span><br><span class="line">#+OPTIONS: H:3</span><br><span class="line">#+BEAMER_THEME: CambridgeUS</span><br><span class="line">#+LATEX_CLASS_OPTION: [presentation]</span><br><span class="line">#+LATEX_COMPILER: pdflatex</span><br><span class="line">#+LATEX_HEADER: \usepackage&#123;physics&#125;</span><br><span class="line">#+BEAMER_HEADER: \institute[Bed, Home]&#123;Bedroom \\ My House&#125;</span><br><span class="line"></span><br><span class="line">* This is a section</span><br><span class="line">** Subsection A</span><br><span class="line">*** Frame one</span><br><span class="line">\begin&#123;equation&#125;</span><br><span class="line">\braket&#123;\phi_i&#125;&#123;\phi_j&#125; = \delta_&#123;ij&#125;</span><br><span class="line">\end&#123;equation&#125;</span><br><span class="line">*** Frame two</span><br><span class="line">Not an empty frame</span><br><span class="line">* This is another section</span><br><span class="line">** Subsection B</span><br><span class="line">non-frame text here</span><br></pre></td></tr></table></figure>
<p>这里, <code>LATEX_COMPILER</code> 和前面 LaTeX 导出中的作用相同. OPTIONS 中用 <code>H:3</code> 指定三级标题转化为 Beamer 帧. 比如这里的 “Frame one” 和 “Frame two” 都会被转化为帧. slides 主题用 <code>BEAMER_THEME</code> 指定. 其他自定义命令用 <code>BEAMER_HEADER</code> 指定, 它们将被添加到 <code>LATEX_HEADER</code> 之后. 与 LaTeX 导出不同, <code>LATEX_CLASS</code> 不是必须的, 导出时默认使用 <code>beamer</code> 类, 但可用 <code>LATEX_CLASS_OPTION</code> 为 Beamer 文档类的 <code>\documentclass</code> 添加选项.</p>
<h2 id="自定义-LaTeX-导出类"><a href="#自定义-LaTeX-导出类" class="headerlink" title="自定义 LaTeX 导出类"></a>自定义 LaTeX 导出类</h2><p>我们可以在 <code>org-latex-classes</code> 中定义比单独 <code>\documentclass</code> 更为复杂的序言. 事实上, Org 会在导出时会检查 header 中的 <code>[DEFAULT-PACKAGES]</code>, <code>[PACKAGES]</code>, <code>[EXTRA]</code> 占位符. 如果没有找到这些占位符, 也没有对应的 <code>[NO-*]</code> 占位符, 那么导出时会 分别用 <code>org-latex-default-packages-alist</code>, <code>org-latex-packages-alist</code> 列表和文档的 <code>LATEX_HEADER</code> 语句展开. 如果找到了任意一个, 则会在该位置展开. 例如, 定义一个新的 <code>colorarticle</code> 类</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">add-to-list</span> 'org-latex-classes</span><br><span class="line">  '(<span class="string">"colorarticle"</span></span><br><span class="line">   <span class="string">"\\documentclass[11pt,4paper]&#123;article&#125;</span></span><br><span class="line"><span class="string">[PACKAGES]</span></span><br><span class="line"><span class="string">\\usepackage[dvipsnames,svgnames*]&#123;xcolors&#125;</span></span><br><span class="line"><span class="string">[EXTRA]</span></span><br><span class="line"><span class="string">\\definecolor&#123;bg&#125;&#123;rgb&#125;&#123;0.95,0.95,0.95&#125;</span></span><br><span class="line"><span class="string">\\definecolors&#123;AliceBlue&#125;</span></span><br><span class="line"><span class="string">[NO-DEFAULT-PACKAGES]"</span></span><br><span class="line">   (<span class="string">"\\section&#123;%s&#125;"</span> . <span class="string">"\\section*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsection&#123;%s&#125;"</span> . <span class="string">"\\subsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subsubsection&#123;%s&#125;"</span> . <span class="string">"\\subsubsection*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\paragraph&#123;%s&#125;"</span> . <span class="string">"\\paragraph*&#123;%s&#125;"</span>)</span><br><span class="line">   (<span class="string">"\\subparagraph&#123;%s&#125;"</span> . <span class="string">"\\subparagraph*&#123;%s&#125;"</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这里会在 xcolors 前导入 <code>org-latex-packages-alist</code> 中定义的包, 在之后导入文档中 <code>LATEX_HEADER</code>, 但不会导入 <code>org-latex-default-packages-alist</code>. 以这种方式引入宏包的目的是方便在不同类中引入一些常用的宏包, 简化自定义类的编写.</p>
<p>之所以提供 <code>org-latex-packages-alist</code> 和 <code>org-latex-default-packages-alist</code> 两个参数, 可能是考虑到有的包适合在序言最开始包括 (如 <code>amsmath</code>, <code>xcolor</code> 等). 而有的包必须放在最后以避免可能的包冲突. (如 <code>hyperref</code>, <code>cleveref</code>). 笔者一般是把前者放在序言头部, 后者放在结尾.</p>
<h3 id="宏包列表"><a href="#宏包列表" class="headerlink" title="宏包列表"></a>宏包列表</h3><p>默认宏包列表 <code>org-latex-default-packages-alist</code> 和宏包列表 <code>org-latex-packages-alist</code> 具有类似的结构. 先看默认宏包 (为简洁起见, 这里只包含一部分)</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-default-packages-alist</span><br><span class="line">  '(</span><br><span class="line">    (<span class="string">""</span> <span class="string">"amsmath"</span> <span class="literal">t</span>) ; include first to avoid iint and iiint error</span><br><span class="line">    (<span class="string">""</span> <span class="string">"amssymb"</span> <span class="literal">t</span>)</span><br><span class="line">    (<span class="string">""</span> <span class="string">"wasysym"</span> <span class="literal">t</span>) ; include last to avoid iint and iint error</span><br><span class="line">    (<span class="string">"AUTO"</span> <span class="string">"inputenc"</span>  <span class="literal">t</span> (<span class="string">"pdflatex"</span>))</span><br><span class="line">    (<span class="string">"T1"</span>   <span class="string">"fontenc"</span>   <span class="literal">t</span> (<span class="string">"pdflatex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"CJKutf8"</span>   <span class="literal">t</span> (<span class="string">"pdflatex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"xeCJK"</span>     <span class="literal">nil</span> (<span class="string">"xelatex"</span>, <span class="string">"xetex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"fontspec"</span>  <span class="literal">nil</span> (<span class="string">"xelatex"</span>, <span class="string">"xetex"</span>, <span class="string">"lualatex"</span>, <span class="string">"luatex"</span>))</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"graphicx"</span>  <span class="literal">t</span>)</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"xcolor"</span>  <span class="literal">t</span>)</span><br><span class="line">    (<span class="string">"newfloat,cache=true"</span>   <span class="string">"minted"</span>   <span class="literal">nil</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>列表中每一个元素是一个列表, 最多包含四个参数</p>
<ol>
<li>宏包的选项 (字符串)</li>
<li>宏包名称 (字符串)</li>
<li>编译 tex 片断预览时是否导入 (布尔值)</li>
<li>编译器 (即 <code>LATEX_COMPILER</code>) 依赖 (列表), 只在用该编译器时导出. 留空则表示无论何编译器均导出.</li>
</ol>
<p><code>org-latex-packages-alist</code> 是类似的</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-packages-alist</span><br><span class="line">  '(; hyperref and cleverf should be the last packages to load</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"hyperref"</span>  <span class="literal">nil</span>)</span><br><span class="line">    (<span class="string">""</span>     <span class="string">"cleveref"</span>   <span class="literal">nil</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>考虑到不同文档中需要 hyperref 包的选项 (链接颜色, 边框等) 不同, 因此比较灵活的办法是留空 alist 变量中 hyperref 的选项, 通过在 LaTeX 类定义的头部中指定 <code>PassOptionsToPackages</code> 来传递选项.</p>
<h3 id="代码块风格控制"><a href="#代码块风格控制" class="headerlink" title="代码块风格控制"></a>代码块风格控制</h3><p>通常有两种方式来控制 LaTeX 文档中代码块的表现, listings 或 minted. 由于 minted 适用的语言更多, 风格也更为灵活, 笔者选择其作为代码块渲染</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-listings 'minted)</span><br></pre></td></tr></table></figure>
<p>并使用 <code>org-latex-minted-options</code> 控制 minted 环境的选项</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="name">setq</span> org-latex-minted-options</span><br><span class="line">      '(</span><br><span class="line">        (<span class="string">"bgcolor"</span> <span class="string">"bg"</span>)</span><br><span class="line">        (<span class="string">"breaklines"</span> <span class="string">"true"</span>)</span><br><span class="line">        (<span class="string">"autogobble"</span> <span class="string">"true"</span>)</span><br><span class="line">        (<span class="string">"fontsize"</span> <span class="string">"\\small"</span>)</span><br><span class="line">       )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="结合-watchman-模拟异步编译"><a href="#结合-watchman-模拟异步编译" class="headerlink" title="结合 watchman 模拟异步编译"></a>结合 watchman 模拟异步编译</h2><p>在 Emacs 内编译 tex 虽然方便, 但是对于编译较大的文档, 或者交叉引用需要多次编译时, 编译动作需要较长的时间. 默认情况下, 编译是在 Emacs 进程内执行的, 这会导致我们在编译时无法进行其他操作, 造成时间的浪费. 在 Linux 下, 可以用 <code>watchman-make</code> 监控 <code>org-directory</code> 下 tex 文件的情况, 一旦有变化就执行 <code>make</code>. <a href="https://facebook.github.io/watchman/docs/watchman-make.html" target="_blank" rel="noopener">watchman-make</a> 是 Facebook 开源项目 <a href="https://facebook.github.io/watchman/" target="_blank" rel="noopener">watchman</a> 的一个组件, 用 Python 编写. 一件需要注意的事情是, 用 Homebrew 安装的 <code>watchman</code>, 在使用时会遇到 <a href="https://github.com/facebook/watchman/issues/631" target="_blank" rel="noopener">name ‘basestring’ is not defined</a> 错误. 简单的修复办法是, 找到它报错的一行把 <code>basestring</code> 改成 <code>str</code>, 然后就能正常使用了.</p>
<p>Org-mode 在内部支持异步导出和编译, 但是需要额外编辑异步导出的模板 <code>async-init.el</code>. 笔者稍微调试了一下这个文件, 但并未成功. 在导出元素比较丰富的 org 文档时, 转换本身可能就比较慢, 需要用异步的方式来提高效率. 目前需要还不是很明显, 等以后有机会研究, 届时再作更新.</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文给出了笔者对 org 文档 LaTeX 导出的基本功能的探索, 对于普通文档的导出应当是够用了. 然而值得推敲和探索的还有很多, 比如异步导出模板, 利用 <code>LATEX_CLASS</code> 实现普通文档和 Beamer 演示导出之间的敏捷切换, 多行多列表格, 以及利用表格和 gnuplot 源代码在 org 文档内直接作图, 等等. 希望之后还有时间精力能把这些分享出来.</p>
<!-- 在 `org-latex-classes` 里准备好 `beamer` 类. 同时, 定义另外一个普通的文档类, 例如名为 `beamerarticle` 的 article 文档类,
并将 `beamerarticle` 包添加到 class 的序言区 (或 `LATEX_HEADER`) 内.-->
	  
	</div>

    
	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
        

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2020/07/19/fiddle-proof/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
    
	
    <!-- bdshare -->
    
        

        

    

	<!-- comment -->
    
<section id="comment">
  <h2 class="title">Comments</h2>

  
<div id="disqus_thread"></div>
<script>
/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://shigaro.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2020-10-01 created
	</div>
	
		
    
	

	<!-- page view by busuanzi -->
	
	<div class="meta-widget">
	<span id="busuanzi_container_page_pv">
	<i class="fa fa-eye"></i>
	<span id="busuanzi_value_page_pv"></span> views
	</span>
	</div>
	

	<!-- post word count -->
	
	<div class="meta-widget">
	<i class="fa fa-tachometer"></i>
	<span class="post-count">2.6k</span> words
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Software/">Software<span class="badge">26</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/LaTeX/">LaTeX<span class="badge">3</span></a></li> <li><a href="/tags/Emacs/">Emacs<span class="badge">3</span></a></li> <li><a href="/tags/Org-mode/">Org-mode<span class="badge">3</span></a></li> <li><a href="/tags/Beamer/">Beamer<span class="badge">1</span></a></li>

    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#前言"><span class="toc-article-text">前言</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#LaTeX-导出的最小工作实例"><span class="toc-article-text">LaTeX 导出的最小工作实例</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Beamer-导出的最小工作实例"><span class="toc-article-text">Beamer 导出的最小工作实例</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#自定义-LaTeX-导出类"><span class="toc-article-text">自定义 LaTeX 导出类</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#宏包列表"><span class="toc-article-text">宏包列表</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#代码块风格控制"><span class="toc-article-text">代码块风格控制</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#结合-watchman-模拟异步编译"><span class="toc-article-text">结合 watchman 模拟异步编译</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#总结"><span class="toc-article-text">总结</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->

<script type="text/javascript">
var disqus_shortname = 'shigaro';
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2020 by <a href="http://shigaro.org"> minyez </a>
  
    | <a href="http://github.com/minyez/hexo-theme-freemind/">Theme</a> based on two Freemind themes by <a href="https://github.com/wzpan/hexo-theme-freemind/">wzpan</a> and <a href="https://github.com/PytLab/hexo-theme-freemind/">PytLab</a> 
    | Powered by <a href="https://github.com/hexojs/hexo">Hexo</a>
  
    <span id="busuanzi_container_site_uv">| <span id="busuanzi_value_site_uv"></span> visitors</span>
  
  
	| <span class="post-count">52.4k</span> words
  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<!--    added 2018-07-12 -->
<!-- modified 2019-05-10 -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111612868-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-111612868-1');
</script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        },
        TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</body>
   </html>
